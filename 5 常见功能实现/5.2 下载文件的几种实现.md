# 下载文件的几种实现

对于已经存在的文件：

- 下载静态文件
- 返回文件流

```csharp
public async Task<ActionResult<string>> GetContentAsync(string path, string md5)
{
    FileData? res = await manager.GetByMd5Async(path, md5);
    if (res == null)
    {
        return NoContent();
    }

    var contentType = "application/octet-stream;charset=utf-8";
    string encodedFileName = System.Web.HttpUtility.UrlEncode(res.FileName, System.Text.Encoding.UTF8);
    Response.Headers.Append(new KeyValuePair<string, Microsoft.Extensions.Primitives.StringValues>("Content-Disposition", $"attachment; filename={encodedFileName}"));
    return new FileContentResult(res.Content, contentType);
}
```

先生成文件再下载

多个文件压缩后下载，实现无需等待直接下载。边压缩加下载。

> [!TIP]
> 查看官方[压缩和解压缩文档](https://learn.microsoft.com/zh-cn/dotnet/standard/io/how-to-compress-and-extract-files)，获取更多信息

```csharp
[HttpGet("stream")]
public async Task DownloadStreamAsync()
{
    Response.Headers.ContentDisposition = "attachment; filename=test.zip";
    var filePath = @"D:\Downloads\VisualStudio.GitHub.Copilot.vsix";
    using (var archive = new ZipArchive(Response.BodyWriter.AsStream(), ZipArchiveMode.Create))
    {
        archive.CreateEntryFromFile(filePath, "test.vsix");
    }

    await Response.CompleteAsync();
}
```
