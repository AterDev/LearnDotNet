# 上传和保存文件

上传的场景：

- 上传普通文件
- 上传大文件
- 分片上传
- 断点续传

保存的情况：

- 保存到Web目录
- 保存到本地存储
- 保存到数据库
- 保存到对象存储


```csharp
public async Task<ActionResult<UploadResult>> UploadImgAsync(IFormFile file)
{
    if (file == null)
    {
        return Problem("没有上传的文件", title: "业务错误");
    }

    if (file.Length > 0)
    {
        string fileExt = Path.GetExtension(file.FileName).ToLowerInvariant();
        long fileSize = file.Length; //获得文件大小，以字节为单位
        //判断后缀是否是图片
        string[] permittedExtensions = new string[] { ".jpeg", ".jpg", ".png", ".bmp", ".svg", ".webp" };

        if (fileExt == null)
        {
            return Problem("上传的文件没有后缀");
        }
        if (!permittedExtensions.Contains(fileExt))
        {
            return Problem("请上传jpg、png格式的图片");
        }
        if (fileSize > 1024 * 500 * 1) //M
        {
            //上传的文件不能大于1M
            return Problem("上传的图片应小于500KB");
        }
        string fileName = HashCrypto.Md5FileHash(file.OpenReadStream());
        var blobPath = Path.Combine("avatar", DateTime.UtcNow.ToString("yyyy-MM-dd"), fileName + fileExt);
        var path = await blobService.UploadStreamAsync("public", blobPath, file.OpenReadStream());

        return new UploadResult()
        {
            FilePath = path,
            Url = path,
        };
    }
    return Problem("文件不正确", title: "业务错误");
}
```